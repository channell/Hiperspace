<Project Sdk="Microsoft.NET.Sdk">
  <PropertyGroup>
    <TargetFrameworks>net8.0;net9.0;net10.0</TargetFrameworks>
    <ImplicitUsings>enable</ImplicitUsings>
    <Nullable>enable</Nullable>
    <GeneratePackageOnBuild>True</GeneratePackageOnBuild>
    <Title>Hiperspace Rocks</Title>
    <Description>HiperSpace RocksDB adaptor</Description>
    <PackageIcon>Hiper.png</PackageIcon>
    <PackageReadmeFile>readme.md</PackageReadmeFile>
    <Copyright>Cepheis Ltd (C) 2023, 2024, 2025</Copyright>
    <LangVersion>13.0</LangVersion>
    <PackageReleaseNotes>https://www.cepheis.com/hiperspace/20251221
# Overview
Change method signatures for Path functions to use Route instead of RouteMap for remote calls.

Add Session2 to Subspace to support time-travel sessions over a graph space to support partial refresh of GPU cache for GPU parallel search of Graph methods without the need for recursive cycle detection.


-----

## Sequence support
Sequence numbers are a relational database feature that has largely been replaced been replaced by [UUID](https://en.wikipedia.org/wiki/Universally_unique_identifier) (*especially v7*) since they do not require a sequence source and can be allocated within a client, but they still have a use as an alternate key especially with [GPGPU](https://en.wikipedia.org/wiki/General-purpose_computing_on_graphics_processing_units) that need primitive points, *but do not wish to use the expense of mapping UUID to int128 values that may not be supported by the device*

**Hiperspace** implements *sequences* as unsigned 64-bit integers (*1 to 18,446,744,073,709,551,616*), and can be stored for any *element* key value

### Hiperspace

Added `UseSequenceAsync()` for driver implementation, together with proxy methods in {`BrowserSpace, FailoverSpace, GenerationSpace, PartitionSpace, SessionSpace`}

### Hiperspace.Heap
Implemented  `UseSequenceAsync()` in `Hiperspace.Heap` and added additional driver `CacheHeapSpace` for use by caches that do not require history to be maintained for elements. **CacheHeapSpace** should *only* be used by *caches* since it lacks the ability to reconcile concurrent changes through version inspection.

`LatestSpace` is replaced by `CacheHeapSpace` and will be removed in a future release.

### Hiperspace.Rocks
Implemented UseSequenceAsync()` in `Hiperspace.Rocks` and added additional driver `CacheRockSpace` for use by caches that do not require history to be maintained for elements. **CacheRockSpace** should *only* be used by *caches* since it lacks the ability to reconcile concurrent changes through version inspection.

The underlying RocksDB driver has been updated.

### SubSpace
`SubSpace` forwards the `UseSequenceAsync()` function to the underlying driver

### SetSpace
Added two functions to get a sequence counter from the driver:
* `GetSequenceAsync&lt;TEntity&gt;(TEntity? element)` to get the current sequence number associated with the domain key
* `UseSequenceAsync&lt;TEntity&gt;(TEntity? element)` to get a new  sequence number for the with the domain key

**NB** While the main use of Sequence numbers is to provide an alternate (*GPGPU friendly*) sequence number for a `Node`, it can be applied to any key value. 
```
// get an order number that is unique within all orders
var orderNo = await space.Orders.UseSequenceAsync (new Order { });

// get a line number within the owning Order {1,2,3..}
var lineNo = await space.Lines.UseSequenceAsync (new Line { Order = order }); 
```

-----

### HiLang

Added code generation for the SubSpace methods.

-----

## OnInitialized
Addition of `virtual void OnInitialized()` function to SubSpace to allow domian subspaces to perform additional initialization after the Domain Space has been created by a generic container (e.g. **Hiperspace.DB**)
</PackageReleaseNotes>
    <PackageLicenseExpression>GPL-2.0-or-later</PackageLicenseExpression>
    <PackageRequireLicenseAcceptance>True</PackageRequireLicenseAcceptance>
    <PackageReadmeFile>readme.md</PackageReadmeFile>
    <Authors>Stephen Channell</Authors>
    <Company>Cepheis Ltd</Company>
    <PackageProjectUrl>https://www.cepheis.com/hiperspace/hiperspace-rocks</PackageProjectUrl>
    <RepositoryUrl>https://github.com/channell/Hiperspace/tree/master/src/Hiperspace.Rocks</RepositoryUrl>
  </PropertyGroup>
  <ItemGroup>
    <None Include="..\Hiper.png">
      <Pack>True</Pack>
      <PackagePath>\</PackagePath>
    </None>
  </ItemGroup>
  <ItemGroup>
    <PackageReference Include="Microsoft.Bcl.HashCode" />
    <!--<PackageReference Include="protobuf-net.Core" />-->
    <PackageReference Include="RocksDB" />
  </ItemGroup>
  <ItemGroup>
    <PackageReference Include="Nerdbank.GitVersioning">
      <PrivateAssets>all</PrivateAssets>
      <IncludeAssets>runtime; build; native; contentfiles; analyzers; buildtransitive</IncludeAssets>
    </PackageReference>
  </ItemGroup>
  <ItemGroup>
    <None Include="readme.md">
      <Pack>True</Pack>
      <PackagePath>\</PackagePath>
    </None>
  </ItemGroup>
  <ItemGroup>
    <ProjectReference Include="..\Hiperspace\Hiperspace.csproj" />
  </ItemGroup>
</Project>